<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="An immersive, interactive map exploring 5 magical experiences in Manali, from the snowy lanes of Old Manali to the spiritual calm of Hidimba Temple.">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline' https://unpkg.com; 
        style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com; 
        img-src 'self' data: https://*.basemaps.cartocdn.com;
        font-src 'self' https://fonts.gstatic.com;
        connect-src 'self' https://*.basemaps.cartocdn.com;
    ">

    <title>Manali: A Soulful Journey</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous"/>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,300;0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Palette: Deep Midnight */
            --bg-deep: #050505;
            --text-primary: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);

            /* Sophisticated Gold */
            --accent-gold: #D4AF37;
            --accent-gold-light: #F4D06F;
            --accent-glow: rgba(212, 175, 55, 0.4);

            /* Glassmorphism - World Class */
            --glass-bg: rgba(20, 20, 25, 0.65);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-highlight: rgba(255, 255, 255, 0.05);
            --glass-shadow:
                0 40px 60px -10px rgba(0, 0, 0, 0.7),
                0 20px 30px -5px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);

            --font-heading: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;

            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);
        }

        html, body {
            margin: 0; padding: 0; height: 100%; width: 100%;
            overflow: hidden; background-color: var(--bg-deep);
            font-family: var(--font-body);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        /* Noise Texture Overlay */
        body::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 5;
            mix-blend-mode: overlay;
        }

        ::selection {
            background: rgba(212, 175, 55, 0.3);
            color: #fff;
        }

        #map {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
            background: var(--bg-deep);
            transition: filter 1s ease;
        }

        body.has-active-story #map {
            filter: brightness(0.6) contrast(1.2) saturation(0.8);
        }

        /* UI Container */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2;
            pointer-events: none;
            display: flex; flex-direction: column;
        }

        /* Header */
        header {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 32px 24px;
            text-align: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            transition: opacity 0.8s var(--ease-out-expo);
            z-index: 20;
        }

        h1 {
            font-family: var(--font-heading);
            font-weight: 300;
            font-size: 2rem;
            margin: 0;
            color: rgba(255,255,255,0.95);
            letter-spacing: 0.02em;
            text-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        /* Start Button - Refined */
        #start-btn {
            position: absolute;
            bottom: 48px; left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 18px 48px;
            border-radius: 100px;
            font-family: var(--font-body);
            font-weight: 400;
            font-size: 1rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: all 0.5s var(--ease-out-expo);
            pointer-events: auto;
            z-index: 10;
            overflow: hidden;
        }

        #start-btn::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(255,255,255,0.2) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        #start-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 16px 48px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.1);
        }
        
        #start-btn:hover::before { opacity: 1; }

        body.has-active-story #start-btn {
            opacity: 0; pointer-events: none; transform: translateX(-50%) translateY(40px);
        }

        body.has-active-story header {
            opacity: 0; pointer-events: none;
        }

        /* Story Card - Mobile (Bottom Sheet) */
        #story-card {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(32px) saturate(140%);
            -webkit-backdrop-filter: blur(32px) saturate(140%);
            border-top: 1px solid var(--glass-border);
            border-radius: 32px 32px 0 0;
            padding: 40px 32px 48px;
            box-shadow: var(--glass-shadow);
            transform: translateY(110%);
            transition: transform 0.8s var(--ease-out-expo), opacity 0.6s ease;
            pointer-events: auto;
            max-height: 70vh;
            overflow-y: auto;
            display: flex; flex-direction: column;
        }

        /* Subtle gradient overlay on card */
        #story-card::after {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, transparent 100%);
            pointer-events: none;
            border-radius: 32px 32px 0 0;
        }

        #story-card.visible {
            transform: translateY(0);
        }

        .card-handle {
            width: 40px; height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            margin: 0 auto 32px;
            cursor: grab;
            transition: background 0.3s, transform 0.2s;
            flex-shrink: 0;
            z-index: 2;
        }
        .card-handle:active { cursor: grabbing; transform: scale(1.1); background: rgba(255,255,255,0.4); }

        .story-content {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.5s ease, transform 0.5s var(--ease-out-expo);
            position: relative; z-index: 2;
        }
        
        .story-content.fade-out {
            opacity: 0;
            transform: translateY(20px);
        }

        #story-card h2 {
            font-family: var(--font-heading);
            font-weight: 400;
            font-size: 2.2rem;
            color: var(--text-primary);
            margin: 0 0 16px 0;
            line-height: 1.1;
            letter-spacing: -0.01em;
            background: linear-gradient(to right, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #story-card p {
            font-size: 1.05rem;
            color: var(--text-secondary);
            line-height: 1.65;
            margin: 0 0 32px 0;
            font-weight: 300;
        }

        /* Navigation Controls inside Card */
        .card-nav {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: auto;
            padding-top: 24px;
            border-top: 1px solid rgba(255,255,255,0.08);
            z-index: 2;
        }

        .nav-btn {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-primary);
            width: 56px; height: 56px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-expo);
        }

        .nav-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.4);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
        }
        
        .nav-btn:disabled {
            opacity: 0.2; cursor: default; border-color: transparent;
        }

        .progress-dots {
            display: flex; gap: 12px;
        }

        .dot {
            width: 6px; height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: all 0.6s var(--ease-out-expo);
        }

        .dot.active {
            background: var(--accent-gold);
            box-shadow: 0 0 12px var(--accent-glow);
            transform: scale(1.5);
        }

        /* Desktop Styles */
        @media (min-width: 1024px) {
            #story-card {
                position: absolute;
                top: 50%; left: 80px; bottom: auto; right: auto;
                transform: translateY(-50%) translateX(-120%) scale(0.95);
                width: 480px;
                border-radius: 24px;
                border: 1px solid var(--glass-border);
                padding: 56px;
                max-height: 80vh;
                backdrop-filter: blur(40px) saturate(160%);
                -webkit-backdrop-filter: blur(40px) saturate(160%);
            }

            #story-card::after { border-radius: 24px; }

            #story-card.visible {
                transform: translateY(-50%) translateX(0) scale(1);
            }

            header {
                text-align: left;
                padding: 48px 80px;
                background: none;
            }

            h1 {
                font-size: 3.5rem;
                letter-spacing: -0.01em;
                color: rgba(255,255,255,0.95);
                max-width: 600px;
            }

            .card-handle { display: none; }

            #start-btn {
                bottom: 80px; left: 80px; transform: translateX(0);
                padding: 20px 56px;
                font-size: 1.1rem;
            }

            #start-btn:hover {
                transform: translateX(0) translateY(-4px);
            }

            body.has-active-story #start-btn {
                 transform: translateX(-40px);
                 opacity: 0;
            }

            .marker-tooltip {
                font-size: 0.85rem;
                padding: 8px 16px;
                background: rgba(0,0,0,0.8);
                backdrop-filter: blur(8px);
            }
        }

        /* Close Button */
        .close-btn {
            position: absolute; top: 24px; right: 24px;
            background: rgba(255,255,255,0.05); border: 1px solid transparent;
            color: var(--text-secondary);
            cursor: pointer; font-size: 1.2rem;
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        .close-btn:hover {
            color: var(--text-primary);
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.2);
        }

        /* Map Markers */
        .custom-marker {
            width: 12px; height: 12px;
            background: var(--text-primary);
            border-radius: 50%;
            transition: all 0.6s var(--ease-out-expo);
            cursor: pointer;
        }
        
        .custom-marker::after {
            content: '';
            position: absolute; top: 50%; left: 50%;
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 1px solid var(--text-primary);
            transform: translate(-50%, -50%) scale(1.4);
            opacity: 0.5;
            transition: all 0.5s ease;
        }

        .custom-marker:hover {
            transform: scale(1.5);
            background: var(--accent-gold);
            box-shadow: 0 0 20px var(--accent-glow);
        }
        .custom-marker:hover::after {
            transform: translate(-50%, -50%) scale(2.5);
            opacity: 0;
            border-color: var(--accent-gold);
        }

        .custom-marker.active {
            background: var(--accent-gold);
            transform: scale(1.5);
            box-shadow: 0 0 30px var(--accent-glow);
            z-index: 1000 !important;
        }

        .custom-marker.active::after {
            display: none;
        }

        /* Pulse Ring for Active */
        .custom-marker.active::before {
            content: '';
            position: absolute; top: 50%; left: 50%;
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 1px solid var(--accent-gold);
            transform: translate(-50%, -50%);
            animation: pulse-ring 2s infinite cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        @keyframes pulse-ring {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(5); opacity: 0; }
        }

        /* Tooltip */
        .marker-tooltip {
            position: absolute;
            bottom: 28px; left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: rgba(10, 10, 15, 0.95);
            color: #fff;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s var(--ease-out-expo);
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            letter-spacing: 0.02em;
        }

        .custom-marker:hover .marker-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        *:focus-visible {
            outline: 2px solid var(--accent-gold);
            outline-offset: 4px;
        }
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;
        }
    </style>
</head>
<body>

    <div id="map"></div>
    
    <div id="ui-layer">
        <header>
            <h1>Manali: A Soulful Journey</h1>
        </header>

        <button id="start-btn" onclick="showExperience(0)">Start the Journey</button>

        <article id="story-card" aria-live="polite">
            <button class="close-btn" aria-label="Close story" onclick="closeStory()">×</button>
            <div class="card-handle"></div>

            <div class="story-content" id="story-content-wrapper">
                <h2 id="story-title">Experience Title</h2>
                <p id="story-description">Description goes here...</p>
            </div>

            <div class="card-nav">
                <button class="nav-btn" id="prev-btn" onclick="navigate(-1)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 18l-6-6 6-6"/></svg>
                    <span class="sr-only">Previous</span>
                </button>

                <div class="progress-dots" id="progress-dots"></div>

                <button class="nav-btn" id="next-btn" onclick="navigate(1)">
                     <span class="sr-only">Next</span>
                     <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 18l6-6-6-6"/></svg>
                </button>
            </div>
        </article>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
    <script>
        const experiences = [
            { title: "Symphony of Snow", description: "Step outside your wooden cottage in Old Manali. The Himalayan peaks shimmer in the early light, draped in fresh snow. The only sounds are the crunch of snow and the distant Beas River. It feels like the world has paused—just for you.", coords: [32.2513, 77.1843], zoom: 15 },
            { title: "Golden Solang", description: "As the sun begins its descent, Solang Valley transforms into a golden dreamscape. The white expanse reflects amber and violet hues. You watch paragliders soar like birds in slow motion, silhouetted against the kaleidoscope. A moment that demands stillness.", coords: [32.3218, 77.1587], zoom: 14 },
            { title: "Whispering Hamta", description: "With every step into the pine-laced trails, the modern world dissolves. The forest speaks in rustles and hushes, sunlight filtering through tall trees like shards of gold. You pause to breathe it in—damp earth, mountain mist, the quiet thrill of discovery.", coords: [32.2981, 77.2796], zoom: 13 },
            { title: "Rooftop Chai", description: "Perched on a rooftop in Vashisht, cup of steaming masala chai warming your hands, you watch clouds dance over snow-dusted ridges. The smell of cinnamon and woodsmoke fills the air. Every sip feels like a quiet celebration of life.", coords: [32.2571, 77.1883], zoom: 16 },
            { title: "Sacred Silence", description: "Tucked inside an ancient forest of towering deodars, Hidimba Temple feels like a portal. Its wooden pagoda architecture rises from the mossy ground. You hear the wind sigh through the trees, mingling with a distant chant. A sacred quiet that grounds you.", coords: [32.2471, 77.1804], zoom: 17 }
        ];

        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([32.28, 77.18], 12);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            subdomains: 'abcd'
        }).addTo(map);

        let currentIndex = -1;
        let markers = [];

        const storyCard = document.getElementById('story-card');
        const titleEl = document.getElementById('story-title');
        const descEl = document.getElementById('story-description');
        const dotsContainer = document.getElementById('progress-dots');
        const contentWrapper = document.getElementById('story-content-wrapper');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // Initialize Markers and Dots
        experiences.forEach((exp, i) => {
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<span class="sr-only">${exp.title}</span><div class="marker-tooltip">${exp.title}</div>`,
                iconSize: [12, 12],
                iconAnchor: [6, 6]
            });
            
            const marker = L.marker(exp.coords, { icon: icon }).addTo(map);
            marker.on('click', () => showExperience(i));

            const el = marker.getElement();
            if(el) {
                el.tabIndex = 0;
                el.role = "button";
                el.ariaLabel = exp.title;
                el.addEventListener('keydown', e => {
                    if (e.key === 'Enter' || e.key === ' ') showExperience(i);
                });
            }

            markers.push(marker);

            const dot = document.createElement('div');
            dot.className = 'dot';
            dotsContainer.appendChild(dot);
        });

        function updateNavState() {
            prevBtn.disabled = currentIndex <= 0;
            nextBtn.disabled = currentIndex >= experiences.length - 1;
            Array.from(dotsContainer.children).forEach((dot, i) => {
                dot.classList.toggle('active', i === currentIndex);
            });
        }

        function showExperience(index) {
            if (index < 0 || index >= experiences.length) return;
            
            document.body.classList.add('has-active-story');
            const isFirstLoad = currentIndex === -1;
            currentIndex = index;
            const exp = experiences[index];

            // Smoother flyTo
            map.flyTo(exp.coords, exp.zoom, {
                animate: true,
                duration: 1.2,
                easeLinearity: 0.1
            });

            if (!isFirstLoad && storyCard.classList.contains('visible')) {
                // Staggered text animation
                contentWrapper.classList.add('fade-out');
                setTimeout(() => {
                    updateContent(exp);
                    contentWrapper.classList.remove('fade-out');
                }, 400);
            } else {
                updateContent(exp);
                storyCard.classList.add('visible');
            }

            markers.forEach((m, i) => {
                const el = m.getElement();
                if (i === index) {
                    el.classList.add('active');
                    m.setZIndexOffset(1000);
                } else {
                    el.classList.remove('active');
                    m.setZIndexOffset(0);
                }
            });

            updateNavState();
        }

        function updateContent(exp) {
            titleEl.textContent = exp.title;
            descEl.textContent = exp.description;
        }

        function navigate(dir) {
            showExperience(currentIndex + dir);
        }
        
        function closeStory() {
            document.body.classList.remove('has-active-story');
            storyCard.classList.remove('visible');
            currentIndex = -1;
            markers.forEach((m) => {
                m.getElement().classList.remove('active');
                m.setZIndexOffset(0);
            });
            map.flyTo([32.28, 77.18], 12, { duration: 1.5 });
        }

        // --- Swipe Gestures for Mobile ---
        let touchStartX = 0;
        let touchEndX = 0;
        const swipeThreshold = 50;

        storyCard.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, {passive: true});

        storyCard.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, {passive: true});

        function handleSwipe() {
            const diff = touchStartX - touchEndX;
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swiped Left -> Next
                    if (currentIndex < experiences.length - 1) navigate(1);
                } else {
                    // Swiped Right -> Prev
                    if (currentIndex > 0) navigate(-1);
                }
            }
        }
    </script>
</body>
</html>

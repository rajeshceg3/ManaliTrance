<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="An immersive, interactive map exploring 5 magical experiences in Manali, from the snowy lanes of Old Manali to the spiritual calm of Hidimba Temple.">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' 'unsafe-inline' https://unpkg.com; 
        style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com; 
        img-src 'self' data: https://*.basemaps.cartocdn.com;
        font-src 'self' https://fonts.gstatic.com;
        connect-src 'self' https://*.basemaps.cartocdn.com;
    ">

    <title>Manali: A Soulful Journey</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous"/>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Palette: Deep Midnight */
            --bg-deep: #020408;
            --text-primary: #FAFAFA;
            --text-secondary: #A1A1AA;

            /* Sophisticated Gold */
            --accent-gold: #E2B340;
            --accent-gold-dim: #997825;
            --accent-glow: rgba(226, 179, 64, 0.3);

            /* Glassmorphism - Ultra Premium */
            --glass-bg: rgba(5, 8, 16, 0.65);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-highlight: rgba(255, 255, 255, 0.03);
            --glass-shadow: 0 24px 48px -12px rgba(0, 0, 0, 0.8),
                            0 4px 24px 0 rgba(0, 0, 0, 0.4);

            --font-heading: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;

            --transition-speed: 0.6s;
            --transition-curve: cubic-bezier(0.22, 1, 0.36, 1); /* Custom ease */
        }

        html, body {
            margin: 0; padding: 0; height: 100%; width: 100%;
            overflow: hidden; background-color: var(--bg-deep);
            font-family: var(--font-body);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        /* Noise Texture Overlay */
        body::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 5;
            mix-blend-mode: overlay;
        }

        ::selection {
            background: rgba(226, 179, 64, 0.3);
            color: #fff;
        }

        #map {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
            background: var(--bg-deep);
            /* Slightly dim the map to pop the UI */
            filter: brightness(0.9) contrast(1.1);
        }

        /* UI Container - Interaction Layer */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2;
            pointer-events: none;
            display: flex; flex-direction: column;
        }

        /* Header */
        header {
            padding: 24px;
            text-align: center;
            background: linear-gradient(to bottom, rgba(11,15,25,0.8) 0%, rgba(11,15,25,0) 100%);
            pointer-events: none;
        }

        h1 {
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 1.5rem;
            margin: 0;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            letter-spacing: 0.02em;
        }

        /* Start Button */
        #start-btn {
            position: absolute;
            bottom: 40px; left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 16px 40px;
            border-radius: 100px;
            font-family: var(--font-body);
            font-weight: 500;
            font-size: 0.95rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: all 0.4s var(--transition-curve);
            pointer-events: auto;
            z-index: 10;
            overflow: hidden;
        }

        #start-btn::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        #start-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--text-primary);
            transform: translateX(-50%) translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }

        #start-btn:hover::before {
            transform: translateX(100%);
        }
        
        body.has-active-story #start-btn {
            opacity: 0; pointer-events: none; transform: translateX(-50%) translateY(20px);
        }

        /* Story Card - Mobile (Bottom Sheet) */
        #story-card {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border-top: 1px solid var(--glass-border);
            border-radius: 32px 32px 0 0;
            padding: 40px 32px 48px;
            box-shadow: var(--glass-shadow);
            transform: translateY(110%);
            transition: transform var(--transition-speed) var(--transition-curve), opacity 0.5s ease;
            pointer-events: auto;
            max-height: 75vh;
            overflow-y: auto;
        }

        /* Inner glow for card */
        #story-card::before {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        }

        #story-card.visible {
            transform: translateY(0);
        }

        .card-handle {
            width: 48px; height: 4px;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            margin: 0 auto 32px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .card-handle:hover { background: rgba(255,255,255,0.3); }

        .story-content {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        
        .story-content.fade-out {
            opacity: 0;
            transform: translateY(10px);
        }

        #story-card h2 {
            font-family: var(--font-heading);
            font-weight: 400;
            font-size: 2rem;
            color: var(--text-primary);
            margin: 0 0 16px 0;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        #story-card p {
            font-size: 1.05rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin: 0 0 32px 0;
            font-weight: 300;
            letter-spacing: 0.01em;
        }

        /* Navigation Controls inside Card */
        .card-nav {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .nav-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            width: 48px; height: 48px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.05);
            border-color: var(--text-primary);
            transform: scale(1.05);
        }
        
        .nav-btn:disabled {
            opacity: 0.3; cursor: default;
        }

        .progress-dots {
            display: flex; gap: 8px;
        }

        .dot {
            width: 32px; height: 2px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            transition: all 0.4s var(--transition-curve);
        }

        .dot.active {
            background: var(--accent-gold);
            box-shadow: 0 0 10px var(--accent-glow);
        }

        /* Tooltip for Markers */
        .marker-tooltip {
            position: absolute;
            bottom: 24px; left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: rgba(5, 8, 16, 0.9);
            color: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .custom-marker:hover .marker-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Desktop Styles */
        @media (min-width: 768px) {
            #story-card {
                position: absolute;
                top: 50%; left: 60px; bottom: auto; right: auto;
                transform: translateY(-50%) translateX(-120%); /* Center vertical, slide from left */
                width: 440px;
                border-radius: 32px;
                border: 1px solid var(--glass-border);
                padding: 48px;
                max-height: 85vh;
            }

            #story-card.visible {
                transform: translateY(-50%) translateX(0);
            }

            header {
                position: absolute; top: 0; left: 0;
                background: none; text-align: left;
                padding: 40px 60px;
                pointer-events: none;
            }

            h1 {
                font-size: 3rem;
                font-weight: 400;
                color: rgba(255,255,255,0.9);
            }

            .card-handle { display: none; }

            #start-btn {
                bottom: 60px; left: 60px; transform: translateX(0);
                width: auto;
            }

            /* Enhanced hover for desktop start button */
            #start-btn:hover {
                transform: translateY(-4px);
            }

            body.has-active-story #start-btn {
                 transform: translateX(-200%); /* Slide out to left */
                 opacity: 0;
            }

            body.has-active-story header {
                opacity: 0;
                transition: opacity 0.5s ease;
            }
        }

        /* Map Markers */
        .custom-marker {
            width: 16px; height: 16px;
            background: var(--accent-gold);
            border: 2px solid #fff;
            border-radius: 50%;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            box-sizing: border-box;
        }
        
        .custom-marker::after {
            content: '';
            position: absolute; top: 50%; left: 50%;
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 1px solid var(--accent-gold);
            transform: translate(-50%, -50%) scale(1);
            opacity: 0;
            transition: all 0.5s ease;
        }

        .custom-marker:hover {
            transform: scale(1.2);
            background: #fff;
            border-color: var(--accent-gold);
        }

        .custom-marker:hover::after {
            transform: translate(-50%, -50%) scale(2.5);
            opacity: 0.5;
        }

        .custom-marker.active {
            background: var(--bg-deep);
            border: 4px solid var(--accent-gold);
            transform: scale(1.3);
            box-shadow: 0 0 30px var(--accent-glow);
            z-index: 1000 !important;
        }

        /* Pulse Ring for Active */
        .custom-marker.active::before {
            content: '';
            position: absolute; top: 50%; left: 50%;
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 2px solid var(--accent-gold);
            transform: translate(-50%, -50%);
            animation: pulse-ring 2.5s infinite;
        }

        @keyframes pulse-ring {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(4); opacity: 0; }
        }

        /* Accessibility */
        *:focus-visible {
            outline: 2px solid var(--accent-gold);
            outline-offset: 4px;
        }

        /* Utils */
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;
        }

        /* Close Button (mostly for desktop if desired, but we have nav) */
        .close-btn {
            position: absolute; top: 20px; right: 20px;
            background: none; border: none; color: var(--text-secondary);
            cursor: pointer; font-size: 1.5rem; line-height: 1;
            padding: 4px; border-radius: 50%;
            transition: color 0.2s;
        }
        .close-btn:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }

    </style>
</head>
<body>

    <div id="map"></div>
    
    <div id="ui-layer">
        <header>
            <h1>Manali: A Soulful Journey</h1>
        </header>

        <button id="start-btn" onclick="showExperience(0)">Start the Journey</button>

        <article id="story-card" aria-live="polite">
            <button class="close-btn" aria-label="Close story" onclick="closeStory()">×</button>
            <div class="card-handle"></div>

            <div class="story-content" id="story-content-wrapper">
                <h2 id="story-title">Experience Title</h2>
                <p id="story-description">Description goes here...</p>
            </div>

            <div class="card-nav">
                <button class="nav-btn" id="prev-btn" onclick="navigate(-1)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                    <span class="sr-only">Previous</span>
                </button>

                <div class="progress-dots" id="progress-dots">
                    <!-- Dots generated by JS -->
                </div>

                <button class="nav-btn" id="next-btn" onclick="navigate(1)">
                     <span class="sr-only">Next</span>
                     <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                </button>
            </div>
        </article>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
    <script>
        // Data
        const experiences = [
            { title: "Waking to a Symphony of Snow", description: "Step outside your wooden cottage in Old Manali. The Himalayan peaks shimmer in the early light, draped in fresh snow. The only sounds are the crunch of snow and the distant Beas River. It feels like the world has paused—just for you.", coords: [32.2513, 77.1843], zoom: 15 },
            { title: "The Spellbinding Glow of Solang", description: "As the sun begins its descent, Solang Valley transforms into a golden dreamscape. The white expanse reflects amber and violet hues. You watch paragliders soar like birds in slow motion, silhouetted against the kaleidoscope. A moment that demands stillness.", coords: [32.3218, 77.1587], zoom: 14 },
            { title: "Whispering Forests of Hamta", description: "With every step into the pine-laced trails, the modern world dissolves. The forest speaks in rustles and hushes, sunlight filtering through tall trees like shards of gold. You pause to breathe it in—damp earth, mountain mist, the quiet thrill of discovery.", coords: [32.2981, 77.2796], zoom: 13 },
            { title: "Chai on a Rooftop in Vashisht", description: "Perched on a rooftop, cup of steaming masala chai warming your hands, you watch clouds dance over snow-dusted ridges. The smell of cinnamon and woodsmoke fills the air. Every sip feels like a quiet celebration of life—untamed, serene, and real.", coords: [32.2571, 77.1883], zoom: 16 },
            { title: "Spiritual Pause at Hidimba Temple", description: "Tucked inside an ancient forest of towering deodars, the temple feels like a portal. Its wooden pagoda architecture rises from the mossy ground. You hear the wind sigh through the trees, mingling with a distant chant. A sacred quiet that grounds you.", coords: [32.2471, 77.1804], zoom: 17 }
        ];

        // Map Init
        const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([32.28, 77.18], 12);

        // CartoDB Dark Matter
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            subdomains: 'abcd'
        }).addTo(map);

        // State
        let currentIndex = -1;
        let markers = [];

        // DOM Elements
        const storyCard = document.getElementById('story-card');
        const titleEl = document.getElementById('story-title');
        const descEl = document.getElementById('story-description');
        const dotsContainer = document.getElementById('progress-dots');
        const contentWrapper = document.getElementById('story-content-wrapper');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');

        // Init UI
        experiences.forEach((exp, i) => {
            // Markers
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<span class="sr-only">${exp.title}</span><div class="marker-tooltip">${exp.title}</div>`,
                iconSize: [16, 16],
                iconAnchor: [8, 8]
            });
            
            const marker = L.marker(exp.coords, { icon: icon }).addTo(map);
            marker.on('click', () => showExperience(i));

            // Keyboard Access
            const el = marker.getElement();
            if(el) {
                el.tabIndex = 0;
                el.role = "button";
                el.ariaLabel = exp.title;
                el.addEventListener('keydown', e => {
                    if (e.key === 'Enter' || e.key === ' ') showExperience(i);
                });
            }

            markers.push(marker);

            // Dots
            const dot = document.createElement('div');
            dot.className = 'dot';
            dotsContainer.appendChild(dot);
        });

        function updateNavState() {
            prevBtn.disabled = currentIndex <= 0;
            nextBtn.disabled = currentIndex >= experiences.length - 1;
            
            // Update dots
            Array.from(dotsContainer.children).forEach((dot, i) => {
                dot.classList.toggle('active', i === currentIndex);
            });
        }

        function showExperience(index) {
            if (index < 0 || index >= experiences.length) return;
            
            document.body.classList.add('has-active-story');

            const isFirstLoad = currentIndex === -1;
            currentIndex = index;
            const exp = experiences[index];

            // 1. Map Move
            map.flyTo(exp.coords, exp.zoom, {
                animate: true,
                duration: 1.5,
                easeLinearity: 0.25
            });

            // 2. Content Transition
            if (!isFirstLoad && storyCard.classList.contains('visible')) {
                contentWrapper.classList.add('fade-out');
                setTimeout(() => {
                    updateContent(exp);
                    contentWrapper.classList.remove('fade-out');
                }, 300);
            } else {
                updateContent(exp);
                storyCard.classList.add('visible');
            }

            // 3. Highlight Marker
            markers.forEach((m, i) => {
                const el = m.getElement();
                if (i === index) {
                    el.classList.add('active');
                    m.setZIndexOffset(1000);
                } else {
                    el.classList.remove('active');
                    m.setZIndexOffset(0);
                }
            });

            updateNavState();
        }

        function updateContent(exp) {
            titleEl.textContent = exp.title;
            descEl.textContent = exp.description;
        }

        function navigate(dir) {
            showExperience(currentIndex + dir);
        }
        
        function closeStory() {
            document.body.classList.remove('has-active-story');
            storyCard.classList.remove('visible');
            currentIndex = -1;
            markers.forEach((m) => {
                m.getElement().classList.remove('active');
                m.setZIndexOffset(0);
            });
            map.flyTo([32.28, 77.18], 12, { duration: 1.5 });
        }
        
        // Initial "Intro" View could be added here,
        // but for now we let the user explore or click a marker.
        // Optionally, start with the first one open?
        // showExperience(0);
    </script>
</body>
</html>
